---
import Copyright from '../components/Copyright.astro';
import Footer from '../components/Footer.astro';
import Header from '../components/Header.astro';
import UpcomingEvents from '../components/UpcomingEvents.astro';
import TrackCard from '../components/TrackCard.astro';
import { getCollection } from 'astro:content';

const isDev = import.meta.env.DEV;
const cssUrl = isDev ? '/styles/global.css' : 'https://static.kdzu.org/styles/global.css';

const tracks = await getCollection('tracks');
const sortedTracks = tracks
  .sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf())
  .slice(0, 6); // Get only the 6 most recent tracks
---

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>KDZU - Antennaobscura!</title>
    <link rel="stylesheet" href={cssUrl} />
  </head>
  <body>
    <Header 
      title="KDZU" 
      subtitle="KDZU is an underground radio station that exists to share the excitements of music and powers of creativity with other people. The US Federal Communications Commission (FCC) does not recognize KDZU as a real station. But if there is a mixer, DJs, human connection, and maybe even catharsis, is that not real?"
    />
    <main>
      <div class="main-content">
        <section>
          <h2>Current Projects</h2>
          <h3>Basslines from the Broken Earth: Wormhole Transmissions from the Rim of the World</h3>
          <p>At 3:03 AM on the summer solstice, our in-studio receiver lit up with a strange new frequency—not our music, but a pulsing transmission filled with future weather reports, fungal poetry, and glitching voices repeating the sentence "Highway 18. Mile marker * garbled signal * Rim of the World."</p> 
          <blockquote class="block-quote">
            "Highway 18. Mile marker * garbled signal * Rim of the World."
          </blockquote>
          <p>Our SDR display flickered, went black, relit, and then locked onto a voice that sounded like rust and rain. "The root-net is live. Tune in. The Earth is speaking. You are a caregiver of my signal now."</p>
          <blockquote class="block-quote">
            "The root-net is live. Tune in. The Earth is speaking. You are a caregiver of my signal now."
          </blockquote>
          <p>We packed in the van and raced to find and re-broadcast radio transmissions from a wormhole at the Rim of the World.</p>
          <p class="text-red"><strong>Here's what we know so far.</strong></p>
          <p>Beneath the cracked asphalt of Highway 18, a pine grove began a slow and silent transformation. Parched by the dry air and stressed by the relentless heat, the trees turned to the road's toxic leavings—metals from brake dust, batteries, and discarded electronics for sustenance. Their roots absorbed these elements and fused them with fungal threads into a glittering system of earthen circuitry. Over time, a giant hidden living underground capacitor formed—part plant and part machine.</p>
          <p>Then, on the lightning-charged summer solstice night, the roots ignited with neural electricity. The ground split. Time sheared. And at the forest's edge, a wormhole opened—pulsing with Earth's subharmoics and spilling out futures no longer willing to wait for our arrival.</p>
          <p>We think our crew at KDZU caught the wormhole's transmissions first as the wormhole broadcast was stepping on the signal of our transmitter. Forever paranoid (for good reason), we thought it might be Federal Agents and eventaully figured out it was a transmission from Earth and from what seem like future timelines.</p>
        </section>

        <section>
          <h2>Hot Tracks We Love</h2>
          <div class="tracks-grid">
            {sortedTracks.map((track) => (
              <TrackCard track={{
                data: track.data,
                slug: track.id,
                body: track.body || ''
              }}>
                {track.body}
              </TrackCard>
            ))}
          </div>
        </section>
      </div>
      <div class="right-column">
        <UpcomingEvents />
      </div>
    </main>
    <Footer />
  </body>
</html>

<style>
  .track-row {
    display: flex;
    flex-direction: column;
    align-items: flex-start;
    border: 1px solid var(--color-dark-gray);
    padding: 1rem;
    border-radius: 4px;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
  }

  .track-image {
    width: 240px;
    height: 240px;
    overflow: hidden;
    margin-bottom: 1rem;
  }

  .track-image img {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  .track-info {
    width: 100%;
  }

  .track-data p {
    margin: 0.25rem 0;
  }
</style>