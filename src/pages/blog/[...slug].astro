---
import { getCollection } from 'astro:content';
import Layout from '../../layouts/Layout.astro';

// Get the slug from the URL
const { slug } = Astro.params;

// Get all posts and find the matching one
const posts = await getCollection('blog');
const post = posts.find(p => p.slug === slug);

// If no post found, return 404
if (!post) {
  return new Response(null, {
    status: 404,
    statusText: 'Not found'
  });
}

const { Content } = await post.render();
---

<Layout>
  <article>
    <header>
      <h1>{post.data.title}</h1>
      <p>{post.data.description}</p>
      <time datetime={post.data.pubDate.toISOString()}>
        {post.data.pubDate.toDateString()}
      </time>
      {post.data.heroImage && (
        <img src={post.data.heroImage} alt={post.data.title} />
      )}
    </header>
    <Content />
  </article>
</Layout>